<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Georgia, " times new roman", "microsoft yahei", "微软雅黑", stxihei, "华文细黑", serif:300,300italic,400,400italic,700,700italic&subset="latin,latin-ext"" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Java,Effective Java,Design Pattern,">





  <link rel="alternate" href="/atom.xml" title="JasonWang's Blog" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/images/sniffer.png?v=5.1.1">






<meta name="description" content="第一遍看完感觉没有学到什么，又看了一遍，然后自己找了些实例对比着理解了书上的要点，算是对Java编程有了更多的认识。以下是 《Effective Java 2nd edition》的摘记。 Consider static factory methods instead of constructors相比构造函数，静态工厂方法有哪些优点了？首先，静态工厂方法有自己的名字，这可以增强程序的可读性；其次">
<meta name="keywords" content="Java,Effective Java,Design Pattern">
<meta property="og:type" content="article">
<meta property="og:title" content="《Effective Java》摘记">
<meta property="og:url" content="http://sniffer.site/2017/02/25/《Effective-Java》摘记/index.html">
<meta property="og:site_name" content="JasonWang&#39;s Blog">
<meta property="og:description" content="第一遍看完感觉没有学到什么，又看了一遍，然后自己找了些实例对比着理解了书上的要点，算是对Java编程有了更多的认识。以下是 《Effective Java 2nd edition》的摘记。 Consider static factory methods instead of constructors相比构造函数，静态工厂方法有哪些优点了？首先，静态工厂方法有自己的名字，这可以增强程序的可读性；其次">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-09-30T08:02:04.525Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Effective Java》摘记">
<meta name="twitter:description" content="第一遍看完感觉没有学到什么，又看了一遍，然后自己找了些实例对比着理解了书上的要点，算是对Java编程有了更多的认识。以下是 《Effective Java 2nd edition》的摘记。 Consider static factory methods instead of constructors相比构造函数，静态工厂方法有哪些优点了？首先，静态工厂方法有自己的名字，这可以增强程序的可读性；其次">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '1POSCBVZ02',
      apiKey: 'bf09f0197d475fa69488099407011316',
      indexName: 'getstarted_actors',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://sniffer.site/2017/02/25/《Effective-Java》摘记/">





  <title>《Effective Java》摘记 | JasonWang's Blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JasonWang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">本色做人，角色做事</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://sniffer.site/2017/02/25/《Effective-Java》摘记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/gallaxy.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JasonWang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">《Effective Java》摘记</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-25T10:51:49+08:00">
                2017-02-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/02/25/《Effective-Java》摘记/" class="leancloud_visitors" data-flag-title="《Effective Java》摘记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>第一遍看完感觉没有学到什么，又看了一遍，然后自己找了些实例对比着理解了书上的要点，算是对Java编程有了更多的认识。以下是 《Effective Java 2nd edition》的摘记。</p>
<h2 id="Consider-static-factory-methods-instead-of-constructors"><a href="#Consider-static-factory-methods-instead-of-constructors" class="headerlink" title="Consider static factory methods instead of constructors"></a><strong>Consider <em>static factory methods</em> instead of constructors</strong></h2><p>相比构造函数，静态工厂方法有哪些优点了？首先，静态工厂方法有自己的名字，这可以增强程序的可读性；其次，静态工厂方法每次调用时，不用创建新的对象实例；第三，静态工厂方法可以返回其返回类型的任何子类型对象。</p>
<a id="more"></a>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Boolean</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>,</span></span><br><span class="line"><span class="class">                                      <span class="title">Comparable</span>&lt;<span class="title">Boolean</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Boolean TRUE = <span class="keyword">new</span> Boolean(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Boolean FALSE = <span class="keyword">new</span> Boolean(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">//根据boolean值返回相应的Boolean对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">valueOf</span><span class="params">(<span class="keyword">boolean</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (b ? TRUE : FALSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Consider-a-builder-when-faced-with-many-constructor-parameters"><a href="#Consider-a-builder-when-faced-with-many-constructor-parameters" class="headerlink" title="Consider a builder when faced with many constructor parameters"></a><strong>Consider a </strong>builder<strong> when faced with many constructor parameters</strong></h2><p>当存在多个参数时，静态工厂方法和构造函数都会遇到问题。以往的做法是，使用<em>telescoping constructor</em>,对外提供多个构造函数，每个构造函数有不同个数的参数。例如，Android中的<code>View</code>，共有四个构造函数，第一个构造函数有一个参数，一次类推，第四个构造函数则由四个参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    mContext = context;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context, attrs, defStyleAttr, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">View</span><span class="params">(Context context, @Nullable AttributeSet attrs, <span class="keyword">int</span> defStyleAttr, <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(context);</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>但如果参数太多，<code>telescoping constructor</code>方法也会变得难以卒读。还有一种方式就是采用<em>JavaBeans</em>，但<em>JavaBeans</em>也有自身的不足:由于构造实例是通过多个接口进行的，一个<em>JavaBean</em>可能使实例处于不一致的状态，另一方面也会一个类处于可变状态(<strong>mutable</strong>)。</p>
<blockquote>
<p>关于什么是JavaBeans: <a href="http://stackoverflow.com/questions/3295496/what-is-a-javabean-exactly" target="_blank" rel="noopener">what-is-a-javabean-exactly</a>；<br><a href="https://en.wikipedia.org/wiki/JavaBeans" target="_blank" rel="noopener">wikipedia：JavaBeans</a></p>
</blockquote>
<p>结合上述两种方法的优点，<em>builder</em>模式很好的解决了上述问题：用户获取到一个<code>builder</code>对象，然后将设定的参数传递给该对象，最后通过<code>buidler</code>对象来产生一个不可变的目标对象。通常，<code>builder</code>对象是被构造类的静态成员类。在Android中，构造<code>AlertDialog</code>时，就用到了这种方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AlertDialog</span> <span class="keyword">extends</span> <span class="title">Dialog</span> <span class="keyword">implements</span> <span class="title">DialogInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> AlertController.AlertParams P;</span><br><span class="line">    </span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">boolean</span> mIsDeviceDefaultLight;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> mTheme;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>(context, resolveDialogTheme(context, <span class="number">0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context, <span class="keyword">int</span> themeResId)</span> </span>&#123;</span><br><span class="line">                P = <span class="keyword">new</span> AlertController.AlertParams(<span class="keyword">new</span> ContextThemeWrapper(</span><br><span class="line">                        context, resolveDialogTheme(context, themeResId)));</span><br><span class="line">    </span><br><span class="line">                mTheme = themeResId;</span><br><span class="line">                ....</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            .....</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setTitle</span><span class="params">(CharSequence title)</span> </span>&#123;</span><br><span class="line">                P.mTitle = title;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setCustomTitle</span><span class="params">(View customTitleView)</span> </span>&#123;</span><br><span class="line">                P.mCustomTitleView = customTitleView;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setMessage</span><span class="params">(CharSequence message)</span> </span>&#123;</span><br><span class="line">                P.mMessage = message;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setIcon</span><span class="params">(@DrawableRes <span class="keyword">int</span> iconId)</span> </span>&#123;</span><br><span class="line">                P.mIconId = iconId;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ....</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setPositiveButton</span><span class="params">(CharSequence text, <span class="keyword">final</span> OnClickListener listener)</span> </span>&#123;</span><br><span class="line">                P.mPositiveButtonText = text;</span><br><span class="line">                P.mPositiveButtonListener = listener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setNegativeButton</span><span class="params">(@StringRes <span class="keyword">int</span> textId, <span class="keyword">final</span> OnClickListener listener)</span> </span>&#123;</span><br><span class="line">                P.mNegativeButtonText = P.mContext.getText(textId);</span><br><span class="line">                P.mNegativeButtonListener = listener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setNeutralButton</span><span class="params">(@StringRes <span class="keyword">int</span> textId, <span class="keyword">final</span> OnClickListener listener)</span> </span>&#123;</span><br><span class="line">                P.mNeutralButtonText = P.mContext.getText(textId);</span><br><span class="line">                P.mNeutralButtonListener = listener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setCancelable</span><span class="params">(<span class="keyword">boolean</span> cancelable)</span> </span>&#123;</span><br><span class="line">                P.mCancelable = cancelable;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setOnCancelListener</span><span class="params">(OnCancelListener onCancelListener)</span> </span>&#123;</span><br><span class="line">                P.mOnCancelListener = onCancelListener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setItems</span><span class="params">(@ArrayRes <span class="keyword">int</span> itemsId, <span class="keyword">final</span> OnClickListener listener)</span> </span>&#123;</span><br><span class="line">                P.mItems = P.mContext.getResources().getTextArray(itemsId);</span><br><span class="line">                P.mOnClickListener = listener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setAdapter</span><span class="params">(<span class="keyword">final</span> ListAdapter adapter, <span class="keyword">final</span> OnClickListener listener)</span> </span>&#123;</span><br><span class="line">                P.mAdapter = adapter;</span><br><span class="line">                P.mOnClickListener = listener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setCursor</span><span class="params">(<span class="keyword">final</span> Cursor cursor, <span class="keyword">final</span> OnClickListener listener,</span></span></span><br><span class="line"><span class="function"><span class="params">                    String labelColumn)</span> </span>&#123;</span><br><span class="line">                P.mCursor = cursor;</span><br><span class="line">                P.mLabelColumn = labelColumn;</span><br><span class="line">                P.mOnClickListener = listener;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            .....</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> Builder <span class="title">setView</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">                P.mView = view;</span><br><span class="line">                P.mViewLayoutResId = <span class="number">0</span>;</span><br><span class="line">                P.mViewSpacingSpecified = <span class="keyword">false</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="function"><span class="keyword">public</span> AlertDialog <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                AlertDialog dialog;</span><br><span class="line">                <span class="keyword">if</span>(mIsDeviceDefaultLight) &#123;</span><br><span class="line">                    dialog = <span class="keyword">new</span> AlertDialog(P.mContext, mTheme , <span class="keyword">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dialog = <span class="keyword">new</span> AlertDialog(P.mContext, <span class="number">0</span>, <span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">    </span><br><span class="line">                P.apply(dialog.mAlert);</span><br><span class="line">                ....</span><br><span class="line">                <span class="keyword">return</span> dialog;</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">            <span class="function"><span class="keyword">public</span> AlertDialog <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> AlertDialog dialog = create();</span><br><span class="line">                dialog.show();</span><br><span class="line">                <span class="keyword">return</span> dialog;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>总的说来，在所构造的对象有很多参数时，特别地，有些参数时可选的，<em>builder</em>模式是一个非常不错的选择。相比而言，使用<em>builder</em>模式，客户端代码更简洁易读(<em>telescoping constructor</em>)，也更安全（可构造一个不可变的对象,<em>JavaBeans</em>）。</p>
<h2 id="Eliminate-obsolete-object-references"><a href="#Eliminate-obsolete-object-references" class="headerlink" title="Eliminate obsolete object references"></a><strong>Eliminate obsolete object references</strong></h2><p>An obsolete reference is simply a reference that will never be dereferenced again. Memory leaks in garbage-collected languages(known as <em>unintentional object retentions</em>) are insidious. If an object reference is unintentionally retained, not only is that object excluded from garbage collection, but so too are any objects referenced by that object, and so on.</p>
<p>The fix for this sort of problem is simple: null out references once they become obsolete. So, when object references should be nulled?</p>
<ol>
<li><strong>Nulling out object references should be the exception rather than the norm</strong>. The best way to eliminate an obsolete reference is to let the variable that contained the reference fall out of scope. This occurs naturally if you define each variable in the narrowest possible scope.</li>
<li>Generally speaking, <strong>whenever a class manages its own memory, the programmer should be alert for memory leaks</strong>. Whenever an element is freed, any object references contained in the element should be nulled out.</li>
<li><strong>Another commmon source of memory leaks is caches</strong>: once you put an object reference into a cache, it’s easy to forget that it’s there and leave it in the cache long after it becomes irrelevant.</li>
<li><strong>A third common source of memory leaks is listeners and callbacks</strong>: if you implement an API where clients register callbacks but don’t deregister them explicitly, they will accumulate unless you take some action.</li>
</ol>
<h2 id="Obey-the-general-contract-when-overriding-equals"><a href="#Obey-the-general-contract-when-overriding-equals" class="headerlink" title="Obey the general contract when overriding equals"></a><strong>Obey the general contract when overriding <em>equals</em></strong></h2><p>什么时候不需要重载<em>object</em>中的<em>equals</em>方法了？</p>
<ol>
<li>类的每个实例都是唯一的：例如像<em>Thread</em>这种活动实体类；</li>
<li>不用关心类是否提供了“逻辑相等”测试：比如<em>java.util.Random</em>类并不需要重载<em>equals</em>方法来检测两个实例是否相同；</li>
<li>父类已经重载了<em>equals</em>，而且该方法同样适用于这个类时，不用再重载；</li>
<li>类时私有的或者包私有的，并且可以确定<em>equals</em>方法不会被调用，则不用重载。</li>
</ol>
<p>那么，在重载<em>equals</em>方法时，需要遵循那些原则了？</p>
<ol>
<li>反射性(reflexive): 对任何非NULL引用 x, <code>x.equals(x)</code>必须为真；</li>
<li>对称性(symmetric): 对任何非NULL引用 x,y: 当且仅当<code>x.equals(y)</code>返回真时，<code>y.equals(x)</code>才为真；</li>
<li>传递性(transitive): 对任何非NULL引用x,y,z,如果<code>x.equals(y)</code>和<code>y.equals(z)</code>均为真，则<code>x.equals(z)</code>也为真；</li>
<li>一致性(consisitency): 如果两个非NULL引用x,y相等，那么应该一直相等除非有一个被改变了；</li>
<li>空值行(Non-nullity): 对于任何非NULL引用 x，<code>x.equals(NULL)</code>为假；</li>
</ol>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The value is used for character storage. */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"></span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">            String anotherString = (String) anObject;</span><br><span class="line">            <span class="keyword">int</span> n = value.length;</span><br><span class="line">            <span class="keyword">if</span> (n == anotherString.value.length) &#123;</span><br><span class="line">                <span class="keyword">char</span> v1[] = value;</span><br><span class="line">                <span class="keyword">char</span> v2[] = anotherString.value;</span><br><span class="line">                <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (v1[i] != v2[i])</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Always-override-hashCode-when-you-override-equals"><a href="#Always-override-hashCode-when-you-override-equals" class="headerlink" title="Always override hashCode when you override equals"></a><strong>Always override <em>hashCode</em> when you override <em>equals</em></strong></h2><p>如果重载<em>equals</em>时，不重载<em>hashCode</em>的话，在使用基于hash值的集合类，如<code>HashMap</code>,<code>HashSet</code>,<code>Hashtable</code>时，可能出现异常情况。</p>
<p>那么，如何写好一个<em>hashCode</em>函数了？</p>
<ol>
<li>将一个int型变量 result 初始化为一个非零值，比如17；</li>
<li><p>对于类中不同类型的成员变量，其相应的hash值 c 如下：</p>
<ul>
<li>boolean: c = (f ? 0 : 1)</li>
<li>byte, char,short, or int: c = (int) f</li>
<li>long: c = (int) (f ^( f &gt;&gt;&gt; 32))</li>
<li>float: c = Float.floatToIntBits(f)</li>
<li>double: long l = Double.doubleToLongBits(f);c = (int)(1^(l &gt;&gt;&gt; 32))</li>
<li>Object: c = f.hashCode()</li>
<li>Array: 应用上述规则</li>
<li>将所得hash值计算存入result: result = 31 * result + c;</li>
</ul>
</li>
<li><p>返回结果；并确保两个相等(equals)的对象是否有相同的hash值；</p>
</li>
</ol>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileKey</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mDev;    <span class="comment">// ID of device</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> mIno;    <span class="comment">// Inode number</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">FileKey</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)(mDev ^ (mDev &gt;&gt;&gt; <span class="number">32</span>)) +</span><br><span class="line">               (<span class="keyword">int</span>)(mIno ^ (mIno &gt;&gt;&gt; <span class="number">32</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (!(obj <span class="keyword">instanceof</span> FileKey))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        FileKey other = (FileKey)obj;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">this</span>.mDev != other.mDev) ||</span><br><span class="line">            (<span class="keyword">this</span>.mIno != other.mIno)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Always-override-toString"><a href="#Always-override-toString" class="headerlink" title="Always override toString"></a><strong>Always override <em>toString</em></strong></h2><p>重载<code>toString()</code>函数可以让类使用起来更方便。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Mode</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mModeId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mHeight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">float</span> mRefreshRate;    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringBuilder(<span class="string">"&#123;"</span>)</span><br><span class="line">                .append(<span class="string">"id="</span>).append(mModeId)</span><br><span class="line">                .append(<span class="string">", width="</span>).append(mWidth)</span><br><span class="line">                .append(<span class="string">", height="</span>).append(mHeight)</span><br><span class="line">                .append(<span class="string">", fps="</span>).append(mRefreshRate)</span><br><span class="line">                .append(<span class="string">"&#125;"</span>)</span><br><span class="line">                .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Mininmize-mutability"><a href="#Mininmize-mutability" class="headerlink" title="Mininmize mutability"></a><strong>Mininmize mutability</strong></h2><p>一个不可变的类是指其对象不可修改。那么，怎么让一个类不可变了？有以下五个原则：</p>
<ol>
<li>不要提供修改对象状态的任何接口(mutators);</li>
<li>确保类不可扩展(extend)：防止类被子类化的简单办法是将其声明为final;或者将其构造函数都声明为<em>private</em>，紧急只提供一个静态的工厂方法来产生类的对象；</li>
<li>将所有成员变量声明为<em>final</em>；</li>
<li>将所有成员声明为<em>private</em>；</li>
<li>有可变的成员变量时，确保其不可被外部修改；</li>
</ol>
<h2 id="Favor-composition-over-inheritance"><a href="#Favor-composition-over-inheritance" class="headerlink" title="Favor composition over inheritance"></a><strong>Favor composition over inheritance</strong></h2><p>跟方法调用不同的是，继承（不是<em>interface implementation</em>)与封装原则是冲突的。在子类确实一个父类的一个子类型时，继承比较合适。换句话说，类B需要扩展类A，仅当两个类之间存在<em>是一个</em>的关系时。因此，在选择使用继承与组合时，应该问一问：类B是否是一个类A？如果不是，则考虑使用组合。</p>
<p>另外，在考虑使用继承时，还应该考虑下：被继承的类的API是否存在缺陷？如果有的话，使用继承方法则会将API的缺陷带入子类，而使用组合，则可以通过包装(<em>wrapper</em>)的方式隐藏这些缺陷。</p>
<h2 id="Prefer-interfaces-to-abstract-classes"><a href="#Prefer-interfaces-to-abstract-classes" class="headerlink" title="Prefer interfaces to abstract classes"></a><strong>Prefer interfaces to abstract classes</strong></h2><p>It is far easier to evolve an abstract class than an interface(once an interface is released and widely implemented, it is almost impossible to change);</p>
<p>In summary, an interface is generally the best way to define a type that permits multiple implementations. <strong>An exception to this rule is the case where ease of evolution is deemed more important than flexibility and power</strong>.</p>
<h2 id="Favor-static-member-classes-over-nonstatic"><a href="#Favor-static-member-classes-over-nonstatic" class="headerlink" title="Favor static member classes over nonstatic"></a><strong>Favor static member classes over nonstatic</strong></h2><p>If you declare a member class that doesnot require access to an enclosing instance, always put the static modifier in its declaration.</p>
<h2 id="Do-not-use-raw-types-in-new-code"><a href="#Do-not-use-raw-types-in-new-code" class="headerlink" title="Do not use raw types in new code"></a><strong>Do not use raw types in new code</strong></h2><p>Using raw types can lead to exceptions at runtime, so don’t use them in new code. </p>
<blockquote>
<p>You must use raw types in class literals: <code>List.class</code>,<code>String[].class</code>,and <code>int.class</code> are all legal,but <code>List&lt;String&gt;.class</code>和<code>List&lt;?&gt;.class</code> are not</p>
</blockquote>
<h2 id="Eliminate-unchecked-warnings"><a href="#Eliminate-unchecked-warnings" class="headerlink" title="Eliminate unchecked warnings"></a><strong>Eliminate unchecked warnings</strong></h2><p>每一个unchecked warnings都很重要，它表示了一个运行时可能出现的<code>ClassCastException</code>，尽可能的移除这些警告。如果无法消除这些警告，并且可以十分确定代码是typesafe的话，在尽可能小的范围内使用<code>@SuppressWarnings(&quot;unchecked&quot;)</code>注解将这些警告移除，并作出相应的comment。</p>
<h2 id="User-bouned-wildcards-to-increase-API-flexibility"><a href="#User-bouned-wildcards-to-increase-API-flexibility" class="headerlink" title="User bouned wildcards to increase API flexibility"></a><strong>User bouned wildcards to increase API flexibility</strong></h2><p>参数化的类型(parameterized types)是不可变的，换句话说，对于任何两个不同的类型Type1,Type2,<code>List&lt;Type1&gt;</code>跟<code>List&lt;Type2&gt;</code>是不同的：<code>List&lt;Type1&gt;</code>既非<code>List&lt;Type2&gt;</code>的子类型，也非其父类型。</p>
<p>为了提升API的弹性，使用通用匹配符类型(wildcard types)作为表示生产者(producers)或者消费者(consumers)的输入参数。如果一个输入参数既是生产者又是消费者，通用匹配符类型并无多大帮助.</p>
<blockquote>
<p>记住: Producer-extends, Consumer-super(PECS); all comparables and comparators are consumers</p>
</blockquote>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Producer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">Collection</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">    ....</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span></span>;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Consumer</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">popAll</span><span class="params">(Collection&lt;? <span class="keyword">super</span> E&gt; dst)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!isEmpty())</span><br><span class="line">        dst.add(pop());    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Use-Enums-instead-of-int-constants"><a href="#Use-Enums-instead-of-int-constants" class="headerlink" title="Use Enums instead of int constants "></a><strong>Use Enums instead of int constants </strong></h2><p>什么时候需要使用enum? 在需要固定数目的常量集合时都可以使用。</p>
<p>如果写一个可扩展的enum类型存在困难时，可以声明一个接口然后实现该接口，从而实现可扩展性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Operation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//BasicOperations</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> BasicOperations implements Operation&#123;</span><br><span class="line">    </span><br><span class="line">    ADD(<span class="string">"+"</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x + y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MINUS(<span class="string">"-"</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x - y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MULTIPLY(<span class="string">"*"</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x * y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    DIVIDE(<span class="string">"/"</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(Double.compare(y, <span class="number">0.0</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> Double.NaN;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> x/y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mOpCode;</span><br><span class="line">    </span><br><span class="line">    BasicOperations(String op)&#123;</span><br><span class="line">        mOpCode = op;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mOpCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ExtendOperations</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ExtendOperations implements Operation&#123;</span><br><span class="line"></span><br><span class="line">    POWER(<span class="string">"^"</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Math.pow(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    MOD(<span class="string">"%"</span>)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">apply</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> x % y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String mOpCode;</span><br><span class="line">    </span><br><span class="line">    ExtendOperations(String op)&#123;</span><br><span class="line">        mOpCode = op;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mOpCode;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Prefer-annotations-to-naming-patterns"><a href="#Prefer-annotations-to-naming-patterns" class="headerlink" title="Prefer annotations to naming patterns"></a><strong>Prefer annotations to naming patterns</strong></h2><p>在Java 1.5发布之前，一些工具或者框架采用<em>命名模式</em>对某些程序做特殊的处理，例如JUnit测试框架最开始要求使用者将每个测试方法以<em>test</em>开头。这种方法存在的不足是，万一使用者拼写有误，测试就无法通过；另外一个不足是，对于方法以外的程序部分如类，同样无法进行测试。同时，<em>命名模式</em>无法将参数值与程序元素无法关联，例如假如你想要设计一个测试集合，检查一个方法是否抛出特定的异常，这时本质上来说，异常类型是测试的一个参数。</p>
<p>上述问题都可以使用annotations(注解）来得到解决。这里，我们来定义一个注解类型用于设计用于自动运行并且在抛出异常时失败的测试（使用时只需在方法前面加上:<code>@Test</code>即可）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.METHOD;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(&#123;METHOD&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Test &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在Android的源码中，也可以看到很多注解用于对方法或者类做特殊的处理，例如<code>@TargetApi()</code>用于指定某个方法或者构造函数的API级别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/** Indicates that Lint should treat this type as targeting a given API level, no matter what the</span></span><br><span class="line"><span class="comment">    project target is. */</span></span><br><span class="line"><span class="meta">@Target</span>(&#123;TYPE, METHOD, CONSTRUCTOR&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.CLASS)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> TargetApi &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This sets the target api level for the type..</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考源码: /android/frameworks/base/core/java/android/annotation/</p>
</blockquote>
<h2 id="Design-Method-signatures-carefully"><a href="#Design-Method-signatures-carefully" class="headerlink" title="Design Method signatures carefully"></a><strong>Design Method signatures carefully</strong></h2><p>怎么使得设计的API更容易被理解，更方便的被使用而不易产生错误了？</p>
<ol>
<li>谨慎的命名方法：命名始终遵循标准的命名约定，首要的目标应该是确保命名是可被理解，并且与包内其他命名保持一致；</li>
<li>不要提供太多的方法： 方法太多容易使类变得难以学习，使用，编写文档，测试跟维护，这个对于interface来说尤其如此。因此，当存疑时，应该直接忽略；</li>
<li>避免过长的参数列表：保持四个或者更少的参数。怎么减少参数？有三个办法：一个是将该方法分解为几个不同的方法，每个方法只包含一部分参数；第三个方法是使用<em>Builder模式</em>；</li>
<li>对于参数类型来说，使用interface而不是classes；</li>
<li>尽量使用两个元素的enum类型而非boolean参数，让程序变得更具可读性；</li>
</ol>
<h2 id="Use-overloading-judiciously"><a href="#Use-overloading-judiciously" class="headerlink" title="Use overloading judiciously"></a><strong>Use overloading judiciously</strong></h2><p>overloaded(重载）方法是静态的，其在编译时就确定了如何调用，而overriden(覆盖）方法是动态的，具体如何调用是在运行时确定的。</p>
<h2 id="Return-emtpy-arrays-or-collections-not-nulls"><a href="#Return-emtpy-arrays-or-collections-not-nulls" class="headerlink" title="Return emtpy arrays or collections, not nulls"></a><strong>Return emtpy arrays or collections, not nulls</strong></h2><p>需要返回一个数组或者集合类值时，如果是空，不要返回null，而是返回一个空数组或者空集合。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// emtpy array</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Cheese&gt; allCheeses = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Cheese[] EMPTY_ARRAY_CHEESE = <span class="keyword">new</span> Cheese[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Cheese[] getCheeses()&#123;</span><br><span class="line">    <span class="keyword">return</span> allCheeses.toArray(EMPTY_ARRAY_CHEESE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// collections</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Cheese&gt; allCheeses = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Cheese&gt; <span class="title">getCheeseList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(allCheeses.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> allCheeses;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Write-doc-comments-for-all-exposed-API-elements"><a href="#Write-doc-comments-for-all-exposed-API-elements" class="headerlink" title="Write doc comments for all exposed API elements"></a><strong>Write doc comments for all exposed API elements</strong></h2><p>合适的描述API，需要将每个输出的类、接口、构造函数、方法以及成员变量写评述。同时，为了代码的可维护性，对于不输出的类、接口、构造函数、方法以及成员变量也应做出适当的说明。</p>
<h2 id="Minimize-the-scope-of-local-variables"><a href="#Minimize-the-scope-of-local-variables" class="headerlink" title="Minimize the scope of local variables"></a><strong>Minimize the scope of local variables</strong></h2><p>一个减少局部变量作用域的方法是在它第一次使用时才声明。另外一个办法是尽量让方法的变小，并且每个方法只做一件事。</p>
<h2 id="Refer-to-objects-by-their-interfaces"><a href="#Refer-to-objects-by-their-interfaces" class="headerlink" title="Refer to objects by their interfaces"></a><strong>Refer to objects by their interfaces</strong></h2><p>如果存在合适的接口类型，那么参数，返回值，变量以及成员变量都应该声明为接口类型。</p>
<h2 id="Optimize-judiciously"><a href="#Optimize-judiciously" class="headerlink" title="Optimize judiciously"></a><strong>Optimize judiciously</strong></h2><p>如果过早的进行优化，很可能带来更多的危害而不是好处。不要牺牲合理的架构原则来换取性能：<strong>努力写出好的代码而不是快的代码</strong>。</p>
<blockquote>
<p>M.A.Jackson: we follow two rules in the matter of optimization:</p>
<ul>
<li>Rule 1. Don’t do it;</li>
<li>Rule 2. (for experts only). Don’t do it yet - that is,not until you have a perfectly clear and unoptimized solution.</li>
</ul>
</blockquote>
<h2 id="Use-checked-exceptions-fo-recoverable-conditions-and-runtime-exceptions-for-programming-errors"><a href="#Use-checked-exceptions-fo-recoverable-conditions-and-runtime-exceptions-for-programming-errors" class="headerlink" title="Use checked exceptions fo recoverable conditions and runtime exceptions for programming errors"></a><strong>Use checked exceptions fo recoverable conditions and runtime exceptions for programming errors</strong></h2><p>Java语言提供了三类可抛出对象(throwables):可检查的异常，运行时异常，以及错误。对于客户端需要从异常中恢复的情况，应该使用可检查的异常；而对于编程错误（如客户端调用接口有误）则使用运行时异常。</p>
<h2 id="Synchronize-access-to-shared-mutable-data"><a href="#Synchronize-access-to-shared-mutable-data" class="headerlink" title="Synchronize access to shared mutable data"></a><strong>Synchronize access to shared mutable data</strong></h2><p>适当的实用<em>synchronize</em>,可以确保对象在各个线程中的状态保持一致。在另一方面，同步不仅仅用于互斥访问（任何时候都只有一个线程可以读写），也可用于线程之间的通信。</p>
<p>记住，当有多个线程共享可变数据(mutable data)时，确保每个线程执行读或者写操作时都保持了同步。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Effective-Java/" rel="tag"># Effective Java</a>
          
            <a href="/tags/Design-Pattern/" rel="tag"># Design Pattern</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/21/Android-Phone进程启动过程分析/" rel="next" title="Android Phone进程启动过程分析">
                <i class="fa fa-chevron-left"></i> Android Phone进程启动过程分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/27/追寻真实的自我/" rel="prev" title="追寻真实的自我">
                追寻真实的自我 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTM5NS81OTYz"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/gallaxy.jpg" alt="Jason">
          <p class="site-author-name" itemprop="name">Jason</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">80</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">169</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/runningforlife" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/2573460570" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      微博
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              链接
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.paulgraham.com" title="Paul Graham" target="_blank">Paul Graham</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://coolshell.cn" title="Cool Shell" target="_blank">Cool Shell</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.ruanyifeng.com/home.html" title="阮一峰" target="_blank">阮一峰</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.byvoid.com" title="BYVOID" target="_blank">BYVOID</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.matrix67.com" title="Matrix67" target="_blank">Matrix67</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.codingnow.com" title="云风" target="_blank">云风</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://chuangzaoshi.com" title="创造狮" target="_blank">创造狮</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://medium.com" title="Medium" target="_blank">Medium</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Consider-static-factory-methods-instead-of-constructors"><span class="nav-number">1.</span> <span class="nav-text">Consider static factory methods instead of constructors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Consider-a-builder-when-faced-with-many-constructor-parameters"><span class="nav-number">2.</span> <span class="nav-text">Consider a builder when faced with many constructor parameters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Eliminate-obsolete-object-references"><span class="nav-number">3.</span> <span class="nav-text">Eliminate obsolete object references</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Obey-the-general-contract-when-overriding-equals"><span class="nav-number">4.</span> <span class="nav-text">Obey the general contract when overriding equals</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Always-override-hashCode-when-you-override-equals"><span class="nav-number">5.</span> <span class="nav-text">Always override hashCode when you override equals</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Always-override-toString"><span class="nav-number">6.</span> <span class="nav-text">Always override toString</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mininmize-mutability"><span class="nav-number">7.</span> <span class="nav-text">Mininmize mutability</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Favor-composition-over-inheritance"><span class="nav-number">8.</span> <span class="nav-text">Favor composition over inheritance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prefer-interfaces-to-abstract-classes"><span class="nav-number">9.</span> <span class="nav-text">Prefer interfaces to abstract classes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Favor-static-member-classes-over-nonstatic"><span class="nav-number">10.</span> <span class="nav-text">Favor static member classes over nonstatic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Do-not-use-raw-types-in-new-code"><span class="nav-number">11.</span> <span class="nav-text">Do not use raw types in new code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Eliminate-unchecked-warnings"><span class="nav-number">12.</span> <span class="nav-text">Eliminate unchecked warnings</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#User-bouned-wildcards-to-increase-API-flexibility"><span class="nav-number">13.</span> <span class="nav-text">User bouned wildcards to increase API flexibility</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Enums-instead-of-int-constants"><span class="nav-number">14.</span> <span class="nav-text">Use Enums instead of int constants </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Prefer-annotations-to-naming-patterns"><span class="nav-number">15.</span> <span class="nav-text">Prefer annotations to naming patterns</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Design-Method-signatures-carefully"><span class="nav-number">16.</span> <span class="nav-text">Design Method signatures carefully</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-overloading-judiciously"><span class="nav-number">17.</span> <span class="nav-text">Use overloading judiciously</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Return-emtpy-arrays-or-collections-not-nulls"><span class="nav-number">18.</span> <span class="nav-text">Return emtpy arrays or collections, not nulls</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Write-doc-comments-for-all-exposed-API-elements"><span class="nav-number">19.</span> <span class="nav-text">Write doc comments for all exposed API elements</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Minimize-the-scope-of-local-variables"><span class="nav-number">20.</span> <span class="nav-text">Minimize the scope of local variables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Refer-to-objects-by-their-interfaces"><span class="nav-number">21.</span> <span class="nav-text">Refer to objects by their interfaces</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optimize-judiciously"><span class="nav-number">22.</span> <span class="nav-text">Optimize judiciously</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-checked-exceptions-fo-recoverable-conditions-and-runtime-exceptions-for-programming-errors"><span class="nav-number">23.</span> <span class="nav-text">Use checked exceptions fo recoverable conditions and runtime exceptions for programming errors</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Synchronize-access-to-shared-mutable-data"><span class="nav-number">24.</span> <span class="nav-text">Synchronize access to shared mutable data</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  
  <span class="author" itemprop="copyrightHolder">Jason Wang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


<div class="hosted-pages">
  Hosted by <a class="theme-link" href="https://pages.coding.me">Coding Pages</a>
</div>

        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  

  
    <span class="site-pv">
      
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.1"></script>



  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("rVKgtmJD3PpeVCLXgI3MrnXk-gzGzoHsz", "nj66qROg1RNBE9qxvn1yTFMg");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
